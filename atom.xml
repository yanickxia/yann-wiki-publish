<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Yanick&#39;s Wiki</title>
  
  <subtitle>30岁の魔法师营地</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://wiki.yanick.site/"/>
  <updated>2021-03-22T04:00:31.846Z</updated>
  <id>http://wiki.yanick.site/</id>
  
  <author>
    <name>yanick</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Rust常见问题</title>
    <link href="http://wiki.yanick.site/wiki/rust/rust/"/>
    <id>http://wiki.yanick.site/wiki/rust/rust/</id>
    <published>2021-03-22T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Failed-to-authenticate-when-downloading-repository"><a href="#Failed-to-authenticate-when-downloading-repository" class="headerlink" title="Failed to authenticate when downloading repository"></a>Failed to authenticate when downloading repository</h2><p><a href="https://github.com/rust-lang/cargo/issues/3381" rel="external nofollow noopener noreferrer" target="_blank">git issue</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">eval</span> `ssh-agent -s`</span><br><span class="line">ssh-add</span><br><span class="line">cargo ...</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Failed-to-authenticate-when-downloading-repository&quot;&gt;&lt;a href=&quot;#Failed-to-authenticate-when-downloading-repository&quot; class=&quot;headerlink&quot;
      
    
    </summary>
    
      <category term="rust" scheme="http://wiki.yanick.site/categories/rust/"/>
    
    
  </entry>
  
  <entry>
    <title>构建与调试 Linux 内核</title>
    <link href="http://wiki.yanick.site/wiki/linux/build-and-debug-kernel-simple/"/>
    <id>http://wiki.yanick.site/wiki/linux/build-and-debug-kernel-simple/</id>
    <published>2021-03-19T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Linux-Kenrel"><a href="#Linux-Kenrel" class="headerlink" title="Linux Kenrel"></a>Linux Kenrel</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.ustc.edu.cn/kernel.org/linux/kernel/v4.x/linux-4.19.171.tar.gz</span><br><span class="line">tar -xvf linux-4.19.171.tar.gz</span><br></pre></td></tr></table></figure><h2 id="Install-Build"><a href="#Install-Build" class="headerlink" title="Install Build"></a>Install Build</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y libncurses5-dev libssl-dev bison flex libelf-dev gcc make openssl libc6-dev bc</span><br></pre></td></tr></table></figure><h2 id="CP-Old-Config"><a href="#CP-Old-Config" class="headerlink" title="CP Old Config"></a>CP Old Config</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp /boot/config-4.19.0-14-amd64 .config</span><br><span class="line">make oldconfig</span><br><span class="line"><span class="comment"># for debian</span></span><br><span class="line">sed -ri <span class="string">'/CONFIG_SYSTEM_TRUSTED_KEYS/s/=.+/=""/g'</span> .config</span><br></pre></td></tr></table></figure><h2 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">make -j8</span><br><span class="line">make bzImage</span><br><span class="line">make modules</span><br><span class="line">make modules_install</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><h2 id="disable-kaslr"><a href="#disable-kaslr" class="headerlink" title="disable kaslr"></a>disable kaslr</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/default/grub</span><br><span class="line"><span class="comment"># append nokaslr</span></span><br><span class="line">update-grub</span><br></pre></td></tr></table></figure><h2 id="gdb-stub"><a href="#gdb-stub" class="headerlink" title="gdb stub"></a>gdb stub</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim xxx.vmx</span><br><span class="line">debugStub.listen.guest64.remote = <span class="string">"TRUE"</span></span><br><span class="line">debugStub.listen.guest64 = <span class="string">"TRUE"</span></span><br><span class="line">monitor.debugOnStartGuest64 = <span class="string">"TRUE"</span></span><br></pre></td></tr></table></figure><h2 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h2><pre><code class="bash"></code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Linux-Kenrel&quot;&gt;&lt;a href=&quot;#Linux-Kenrel&quot; class=&quot;headerlink&quot; title=&quot;Linux Kenrel&quot;&gt;&lt;/a&gt;Linux Kenrel&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;t
      
    
    </summary>
    
      <category term="linux" scheme="http://wiki.yanick.site/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>SSL 证书查看</title>
    <link href="http://wiki.yanick.site/wiki/linux/rsa/"/>
    <id>http://wiki.yanick.site/wiki/linux/rsa/</id>
    <published>2021-03-12T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="查看服务器-SSL-证书详情"><a href="#查看服务器-SSL-证书详情" class="headerlink" title="查看服务器 SSL 证书详情"></a>查看服务器 SSL 证书详情</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> | openssl s_client -showcerts -servername &lt;SERVER_NAME&gt; -connect &lt;ADDRESS&gt; 2&gt;/dev/null | openssl x509 -inform pem -noout -text</span><br></pre></td></tr></table></figure><h2 id="查询证书"><a href="#查询证书" class="headerlink" title="查询证书"></a>查询证书</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -<span class="keyword">in</span> &lt;INPUT.pem&gt; -noout -text</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;查看服务器-SSL-证书详情&quot;&gt;&lt;a href=&quot;#查看服务器-SSL-证书详情&quot; class=&quot;headerlink&quot; title=&quot;查看服务器 SSL 证书详情&quot;&gt;&lt;/a&gt;查看服务器 SSL 证书详情&lt;/h2&gt;&lt;figure class=&quot;highlight 
      
    
    </summary>
    
      <category term="linux" scheme="http://wiki.yanick.site/categories/linux/"/>
    
      <category term="ssl" scheme="http://wiki.yanick.site/categories/linux/ssl/"/>
    
    
  </entry>
  
  <entry>
    <title>Build &amp; Debug Envoy</title>
    <link href="http://wiki.yanick.site/wiki/envoy/build-debug-envoy/"/>
    <id>http://wiki.yanick.site/wiki/envoy/build-debug-envoy/</id>
    <published>2021-03-09T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Debug-Compiler"><a href="#Debug-Compiler" class="headerlink" title="Debug Compiler"></a>Debug Compiler</h2><p>首先构建一个可debug的版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bazel build -c dbg --spawn_strategy=standalone //<span class="built_in">source</span>/exe:envoy-static</span><br></pre></td></tr></table></figure><h2 id="生成-dSYM"><a href="#生成-dSYM" class="headerlink" title="生成 dSYM"></a>生成 dSYM</h2><p>进入到 envoy-static 同级目录，执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dsymutil envoy-static -o envoy-static.dSYM</span><br></pre></td></tr></table></figure><h2 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h2><h3 id="Debug-By-LLDB"><a href="#Debug-By-LLDB" class="headerlink" title="Debug By LLDB"></a>Debug By LLDB</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ lldb envoy-static</span><br><span class="line">(lldb) process launch --stop-at-entry -- -c <span class="variable">$PATH_TO_CONFIG</span></span><br><span class="line">(lldb) add-dsym envoy-static.dSYM</span><br><span class="line">(lldb) breakpoint <span class="built_in">set</span> --file server.cc --line 147</span><br><span class="line">(lldb) <span class="built_in">continue</span></span><br></pre></td></tr></table></figure><h3 id="Debug-By-Vscode"><a href="#Debug-By-Vscode" class="headerlink" title="Debug By Vscode"></a>Debug By Vscode</h3><p>open launch.json file and change program to “${workspaceFolder}/bazel-bin/envoy” (lauch.json will open when to start debugging)</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    // Use IntelliSense to learn about possible attributes.</span><br><span class="line">    // Hover to view descriptions of existing attributes.</span><br><span class="line">    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387</span><br><span class="line">    "version": "0.2.0",</span><br><span class="line">    "configurations": [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"(lldb) Launch"</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"cppdbg"</span>,</span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceFolder&#125;/bazel-bin/source/exe/envoy-static"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [<span class="string">"-c"</span>, <span class="string">"envoy.yaml"</span>],</span><br><span class="line">            <span class="attr">"stopAtEntry"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceFolder&#125;"</span>,</span><br><span class="line">            <span class="attr">"environment"</span>: [],</span><br><span class="line">            <span class="attr">"externalConsole"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"MIMode"</span>: <span class="string">"lldb"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Debug-in-Clion"><a href="#Debug-in-Clion" class="headerlink" title="Debug in Clion"></a>Debug in Clion</h3><h4 id="Gen-CMakeList"><a href="#Gen-CMakeList" class="headerlink" title="Gen CMakeList"></a>Gen CMakeList</h4><p>下载 <a href="https://github.com/lizan/bazel-cmakelists" rel="external nofollow noopener noreferrer" target="_blank">bazel-cmakelists</a>，在envoy目录下运行，生成 <code>CMakeLists.txt</code>。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bazel-cmakelists --targets //<span class="built_in">source</span>/exe:envoy-static --skip_build</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/258777260" rel="external nofollow noopener noreferrer" target="_blank">Envoy调试指南</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Debug-Compiler&quot;&gt;&lt;a href=&quot;#Debug-Compiler&quot; class=&quot;headerlink&quot; title=&quot;Debug Compiler&quot;&gt;&lt;/a&gt;Debug Compiler&lt;/h2&gt;&lt;p&gt;首先构建一个可debug的版本&lt;/p&gt;
&lt;f
      
    
    </summary>
    
      <category term="envoy" scheme="http://wiki.yanick.site/categories/envoy/"/>
    
    
  </entry>
  
  <entry>
    <title>Proxy</title>
    <link href="http://wiki.yanick.site/wiki/proxy/proxy/"/>
    <id>http://wiki.yanick.site/wiki/proxy/proxy/</id>
    <published>2021-03-04T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="shadowsocks-代理"><a href="#shadowsocks-代理" class="headerlink" title="shadowsocks 代理"></a>shadowsocks 代理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -dt --name ssserver -p 6443:6443 -p 6500:6500/udp mritd/shadowsocks -m <span class="string">"ss-server"</span> -s <span class="string">"-s 0.0.0.0 -p 6443 -m chacha20-ietf-poly1305 -k Dangerous@123"</span> -x -e <span class="string">"kcpserver"</span> -k <span class="string">"-t 127.0.0.1:6443 -l :6500 -mode fast2"</span></span><br></pre></td></tr></table></figure><h2 id="Socket-5-代理"><a href="#Socket-5-代理" class="headerlink" title="Socket 5 代理"></a>Socket 5 代理</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name socket5-proxy -p 80:1080 -e PROXY_USER=root  -e PROXY_PASSWORD=Dangerous@123 serjs/go-socks5-proxy</span><br></pre></td></tr></table></figure><p>更多参考 <a href="https://hub.docker.com/r/mritd/shadowsocks" rel="external nofollow noopener noreferrer" target="_blank">https://hub.docker.com/r/mritd/shadowsocks</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;shadowsocks-代理&quot;&gt;&lt;a href=&quot;#shadowsocks-代理&quot; class=&quot;headerlink&quot; title=&quot;shadowsocks 代理&quot;&gt;&lt;/a&gt;shadowsocks 代理&lt;/h2&gt;&lt;figure class=&quot;highlight 
      
    
    </summary>
    
      <category term="proxy" scheme="http://wiki.yanick.site/categories/proxy/"/>
    
    
  </entry>
  
  <entry>
    <title>Tips</title>
    <link href="http://wiki.yanick.site/wiki/istio/isito-tips/"/>
    <id>http://wiki.yanick.site/wiki/istio/isito-tips/</id>
    <published>2021-01-24T11:28:41.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="自定义指标前缀"><a href="#自定义指标前缀" class="headerlink" title="自定义指标前缀"></a>自定义指标前缀</h2><p>istio 没有将所有的配置项都释放出来，因此我们可以通过 <code>EnvoyFilter</code> 这个 <code>CRD</code> 进行操作</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">EnvoyFilter</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.istio.io/v1alpha3</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  annotations:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">mysql-stats-settings</span></span><br><span class="line"><span class="attr">  namespace:</span> <span class="string">wordpress</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  configPatches:</span></span><br><span class="line"><span class="attr">  - applyTo:</span> <span class="string">NETWORK_FILTER</span></span><br><span class="line"><span class="attr">    match:</span></span><br><span class="line"><span class="attr">      context:</span> <span class="string">ANY</span></span><br><span class="line"><span class="attr">      listener:</span></span><br><span class="line"><span class="attr">        filterChain:</span></span><br><span class="line"><span class="attr">          filter:</span></span><br><span class="line"><span class="attr">            name:</span> <span class="string">envoy.filters.network.mysql_proxy</span></span><br><span class="line"><span class="attr">    patch:</span></span><br><span class="line"><span class="attr">      operation:</span> <span class="string">MERGE</span></span><br><span class="line"><span class="attr">      value:</span></span><br><span class="line"><span class="attr">        typed_config:</span></span><br><span class="line">          <span class="string">"@type"</span><span class="string">:</span> <span class="string">"type.googleapis.com/envoy.extensions.filters.network.mysql_proxy.v3.MySQLProxy"</span></span><br><span class="line"><span class="attr">          stat_prefix:</span> <span class="string">egress_mysql</span></span><br></pre></td></tr></table></figure><h2 id="Envoy-指标对外暴露"><a href="#Envoy-指标对外暴露" class="headerlink" title="Envoy 指标对外暴露"></a>Envoy 指标对外暴露</h2><p>istio 没有将所有的指标对外暴露，因此需要额外配置： <a href="https://istio.io/latest/docs/ops/configuration/telemetry/envoy-stats/" rel="external nofollow noopener noreferrer" target="_blank">envoy-stats</a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl edit configmaps -n istio-system istio</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"defaultConfig"</span>: &#123;</span><br><span class="line">        <span class="attr">"discoveryAddress"</span>: <span class="string">"istiod.istio-system.svc:15012"</span>,</span><br><span class="line">        <span class="attr">"rootNamespace"</span>: <span class="string">"istio-system"</span>,</span><br><span class="line">        <span class="attr">"trustDomain"</span>: <span class="string">"cluster.local"</span>,</span><br><span class="line">        <span class="attr">"proxyStatsMatcher"</span>: &#123;</span><br><span class="line">            <span class="attr">"inclusionRegexps"</span>: [</span><br><span class="line">                <span class="string">".*mysql.*"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"inclusionPrefixes"</span>: [</span><br><span class="line">                <span class="string">"egress_mysql"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"meshId"</span>: <span class="string">"mesh1"</span>,</span><br><span class="line">        <span class="attr">"enablePrometheusMerge"</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;自定义指标前缀&quot;&gt;&lt;a href=&quot;#自定义指标前缀&quot; class=&quot;headerlink&quot; title=&quot;自定义指标前缀&quot;&gt;&lt;/a&gt;自定义指标前缀&lt;/h2&gt;&lt;p&gt;istio 没有将所有的配置项都释放出来，因此我们可以通过 &lt;code&gt;EnvoyFilter&lt;/c
      
    
    </summary>
    
      <category term="isito" scheme="http://wiki.yanick.site/categories/isito/"/>
    
    
      <category term="isito" scheme="http://wiki.yanick.site/tags/isito/"/>
    
  </entry>
  
  <entry>
    <title>OS 初始化工具安装</title>
    <link href="http://wiki.yanick.site/wiki/tools/os/"/>
    <id>http://wiki.yanick.site/wiki/tools/os/</id>
    <published>2021-01-08T15:10:08.000Z</published>
    <updated>2021-03-22T04:00:31.850Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PRE"><a href="#PRE" class="headerlink" title="PRE"></a>PRE</h2><h3 id="镜像源更换"><a href="#镜像源更换" class="headerlink" title="镜像源更换"></a>镜像源更换</h3><p><a href="https://mirrors.ustc.edu.cn/repogen/" rel="external nofollow noopener noreferrer" target="_blank">USTC MIRROR 生成</a></p><hr><h2 id="ZSH"><a href="#ZSH" class="headerlink" title="ZSH"></a>ZSH</h2><h3 id="国内"><a href="#国内" class="headerlink" title="国内"></a>国内</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install -y git zsh autojump</span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://gitee.com/pocmon/ohmyzsh/raw/master/tools/install.sh)</span>"</span></span><br></pre></td></tr></table></figure><h3 id="全球"><a href="#全球" class="headerlink" title="全球"></a>全球</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt install -y git zsh</span><br><span class="line">sh -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>"</span></span><br></pre></td></tr></table></figure><h3 id="ZSH-Theme-P10K"><a href="#ZSH-Theme-P10K" class="headerlink" title="ZSH Theme P10K"></a>ZSH Theme P10K</h3><h4 id="国内-1"><a href="#国内-1" class="headerlink" title="国内"></a>国内</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --depth=1 https://gitee.com/romkatv/powerlevel10k.git $&#123;ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom&#125;/themes/powerlevel10k</span><br></pre></td></tr></table></figure><h4 id="全球-1"><a href="#全球-1" class="headerlink" title="全球"></a>全球</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> --depth=1 https://github.com/romkatv/powerlevel10k.git <span class="variable">$&#123;ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom&#125;</span>/themes/powerlevel10k</span><br></pre></td></tr></table></figure><hr><p>Set ZSH_THEME=”powerlevel10k/powerlevel10k” in ~/.zshrc.</p><h5 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git -C <span class="variable">$&#123;ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom&#125;</span>/themes/powerlevel10k pull</span><br></pre></td></tr></table></figure><h2 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h2><h3 id="国内-2"><a href="#国内-2" class="headerlink" title="国内"></a>国内</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun</span><br></pre></td></tr></table></figure><h3 id="全球-2"><a href="#全球-2" class="headerlink" title="全球"></a>全球</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://get.docker.com</span><br></pre></td></tr></table></figure><h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><h4 id="国内-3"><a href="#国内-3" class="headerlink" title="国内"></a>国内</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.27.4/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose &amp;&amp; chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure><h4 id="全球-3"><a href="#全球-3" class="headerlink" title="全球"></a>全球</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L <span class="string">"https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class="variable">$(uname -s)</span>-<span class="variable">$(uname -m)</span>"</span> -o /usr/<span class="built_in">local</span>/bin/docker-compose  &amp;&amp; chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure><h2 id="Kube"><a href="#Kube" class="headerlink" title="Kube"></a>Kube</h2><h3 id="国内-4"><a href="#国内-4" class="headerlink" title="国内"></a>国内</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">apt-get install -y apt-transport-https</span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - </span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-stretch main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y kubectl</span><br></pre></td></tr></table></figure><h2 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h2><p>启动 <code>jenkins</code> 之后，访问 <code>${JENKINS}/pluginManager/advanced</code></p><p>替换 <code>update-center.json</code> 为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span><br></pre></td></tr></table></figure><p>进入系统的 update 目录更新</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s/https:\/\/updates.jenkins.io\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g'</span> default.json &amp;&amp; sed -i <span class="string">'s/http:\/\/www.google.com/https:\/\/www.baidu.com/g'</span> default.json</span><br></pre></td></tr></table></figure><p>重启系统<br><code>${JENKINS}/restart</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;PRE&quot;&gt;&lt;a href=&quot;#PRE&quot; class=&quot;headerlink&quot; title=&quot;PRE&quot;&gt;&lt;/a&gt;PRE&lt;/h2&gt;&lt;h3 id=&quot;镜像源更换&quot;&gt;&lt;a href=&quot;#镜像源更换&quot; class=&quot;headerlink&quot; title=&quot;镜像源更换&quot;&gt;&lt;/a&gt;
      
    
    </summary>
    
      <category term="os" scheme="http://wiki.yanick.site/categories/os/"/>
    
    
  </entry>
  
  <entry>
    <title>Gist</title>
    <link href="http://wiki.yanick.site/wiki/gist/gist/"/>
    <id>http://wiki.yanick.site/wiki/gist/gist/</id>
    <published>2020-11-22T17:28:41.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="为Kube-Object增加Type信息"><a href="#为Kube-Object增加Type信息" class="headerlink" title="为Kube Object增加Type信息"></a>为Kube Object增加Type信息</h2><p>因为 <code>Client-GO</code> 返回的 <code>TypeMeta</code> 永远为 <code>Null</code>，因此需要自己添加</p><figure class="highlight go"><figcaption><span>addTypeInformationToObject</span><a href="https://gist.github.com/yanickxia/8a5306ab555034cb862eda5e0f12399a" rel="external nofollow noopener noreferrer" target="_blank">source_code</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">addTypeInformationToObject</span><span class="params">(obj runtime.Object)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    gvks, _, err := scheme.Scheme.ObjectKinds(obj)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">"missing apiVersion or kind and cannot assign it; %w"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, gvk := <span class="keyword">range</span> gvks &#123;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(gvk.Kind) == <span class="number">0</span> &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(gvk.Version) == <span class="number">0</span> || gvk.Version == runtime.APIVersionInternal &#123;</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line">        obj.GetObjectKind().SetGroupVersionKind(gvk)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;为Kube-Object增加Type信息&quot;&gt;&lt;a href=&quot;#为Kube-Object增加Type信息&quot; class=&quot;headerlink&quot; title=&quot;为Kube Object增加Type信息&quot;&gt;&lt;/a&gt;为Kube Object增加Type信息&lt;/h2&gt;&lt;
      
    
    </summary>
    
      <category term="gist" scheme="http://wiki.yanick.site/categories/gist/"/>
    
    
      <category term="gist" scheme="http://wiki.yanick.site/tags/gist/"/>
    
  </entry>
  
  <entry>
    <title>搭建 Istio 开发测试环境</title>
    <link href="http://wiki.yanick.site/wiki/istio/isito-dev-env/"/>
    <id>http://wiki.yanick.site/wiki/istio/isito-dev-env/</id>
    <published>2020-11-03T17:28:41.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Poilot"><a href="#Poilot" class="headerlink" title="Poilot"></a>Poilot</h2><p>为了让我们在本地开发测试 <code>Poilot</code>，首先准备好 <code>kube-config</code></p><p>启动 <code>poilot</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pilot-discovery discovery --kubeconfig ~/.kube/config</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Poilot&quot;&gt;&lt;a href=&quot;#Poilot&quot; class=&quot;headerlink&quot; title=&quot;Poilot&quot;&gt;&lt;/a&gt;Poilot&lt;/h2&gt;&lt;p&gt;为了让我们在本地开发测试 &lt;code&gt;Poilot&lt;/code&gt;，首先准备好 &lt;code&gt;kube-conf
      
    
    </summary>
    
      <category term="isito" scheme="http://wiki.yanick.site/categories/isito/"/>
    
    
      <category term="isito" scheme="http://wiki.yanick.site/tags/isito/"/>
    
  </entry>
  
  <entry>
    <title>kubectl 远程访问内网中的 kubernetes 集群</title>
    <link href="http://wiki.yanick.site/wiki/k8s/kubectl-in-remote/"/>
    <id>http://wiki.yanick.site/wiki/k8s/kubectl-in-remote/</id>
    <published>2020-11-02T16:27:50.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="拷贝-config"><a href="#拷贝-config" class="headerlink" title="拷贝 config"></a>拷贝 config</h2><p>将服务器的 /etc/kubernetes/admin.conf 拷贝至本地的 ~/.kube/config</p><a id="more"></a><h2 id="修改服务器地址"><a href="#修改服务器地址" class="headerlink" title="修改服务器地址"></a>修改服务器地址</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">clusters:</span></span><br><span class="line"><span class="attr">- cluster:</span></span><br><span class="line"><span class="attr">    certificate-authority-data:</span> <span class="string">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN</span></span><br><span class="line"><span class="attr">    server:</span> <span class="attr">https://172.17.43.150:6443</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubernetes</span></span><br></pre></td></tr></table></figure><p>将 <code>server</code> 改成你的远程地址</p><h2 id="重新生成证书"><a href="#重新生成证书" class="headerlink" title="重新生成证书"></a>重新生成证书</h2><h3 id="保存kubeadm-配置"><a href="#保存kubeadm-配置" class="headerlink" title="保存kubeadm 配置"></a>保存kubeadm 配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n kube-system get configmap kubeadm-config -o jsonpath=<span class="string">'&#123;.data.ClusterConfiguration&#125;'</span> &gt; kubeadm.yaml</span><br></pre></td></tr></table></figure><h3 id="增加可信地址"><a href="#增加可信地址" class="headerlink" title="增加可信地址"></a>增加可信地址</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiServer:</span></span><br><span class="line"><span class="attr">  extraArgs:</span></span><br><span class="line"><span class="attr">    authorization-mode:</span> <span class="string">Node,RBAC</span></span><br><span class="line"><span class="attr">  timeoutForControlPlane:</span> <span class="number">4</span><span class="string">m0s</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta2</span></span><br><span class="line"><span class="attr">certificatesDir:</span> <span class="string">/etc/kubernetes/pki</span></span><br><span class="line"><span class="attr">clusterName:</span> <span class="string">kubernetes</span></span><br><span class="line"><span class="attr">controllerManager:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure><p>修改为</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiServer:</span></span><br><span class="line"><span class="attr">  certSANs:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">"&lt;YOUR_IP&gt;"</span></span><br><span class="line"><span class="attr">  extraArgs:</span></span><br><span class="line"><span class="attr">    authorization-mode:</span> <span class="string">Node,RBAC</span></span><br><span class="line"><span class="attr">  timeoutForControlPlane:</span> <span class="number">4</span><span class="string">m0s</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">kubeadm.k8s.io/v1beta2</span></span><br><span class="line"><span class="attr">certificatesDir:</span> <span class="string">/etc/kubernetes/pki</span></span><br><span class="line"><span class="attr">clusterName:</span> <span class="string">kubernetes</span></span><br><span class="line"><span class="attr">controllerManager:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure><h3 id="生成新的证书"><a href="#生成新的证书" class="headerlink" title="生成新的证书"></a>生成新的证书</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 删除 crt</span></span><br><span class="line">mv /etc/kubernetes/pki/apiserver.&#123;crt,key&#125; ~</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成证书</span></span><br><span class="line">kubeadm init phase certs apiserver --config kubeadm.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启 api server</span></span><br><span class="line">docker <span class="built_in">kill</span> $(docker ps | grep kube-apiserver | grep -v pause | awk <span class="string">'&#123;print $1&#125;'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新配置</span></span><br><span class="line">kubeadm config migrate --old-config kubeadm.yaml</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;拷贝-config&quot;&gt;&lt;a href=&quot;#拷贝-config&quot; class=&quot;headerlink&quot; title=&quot;拷贝 config&quot;&gt;&lt;/a&gt;拷贝 config&lt;/h2&gt;&lt;p&gt;将服务器的 /etc/kubernetes/admin.conf 拷贝至本地的 ~/.kube/config&lt;/p&gt;
    
    </summary>
    
      <category term="cncf" scheme="http://wiki.yanick.site/categories/cncf/"/>
    
      <category term="kubernetes" scheme="http://wiki.yanick.site/categories/cncf/kubernetes/"/>
    
    
  </entry>
  
  <entry>
    <title>Isito の Debug</title>
    <link href="http://wiki.yanick.site/wiki/istio/isito-debug/"/>
    <id>http://wiki.yanick.site/wiki/istio/isito-debug/</id>
    <published>2020-10-29T17:28:41.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s3.jpg.cm/2020/10/29/Nhq9u.png" alt="Nhq9u.png"></p><a id="more"></a><h2 id="状态检查"><a href="#状态检查" class="headerlink" title="状态检查"></a>状态检查</h2><p>最常见的是 <code>istioctl proxy-status</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">istioctl proxy-status</span><br><span class="line"></span><br><span class="line">NAME                                                   CDS        LDS        EDS        RDS          ISTIOD                      VERSION</span><br><span class="line">details-v1-558b8b4b76-qzqsg.default                    SYNCED     SYNCED     SYNCED     SYNCED       istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br><span class="line">istio-ingressgateway-66c994c45c-cmb7x.istio-system     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br><span class="line">productpage-v1-6987489c74-nc7tj.default                SYNCED     SYNCED     SYNCED     SYNCED       istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br><span class="line">prometheus-7bdc59c94d-hcp59.istio-system               SYNCED     SYNCED     SYNCED     SYNCED       istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br><span class="line">ratings-v1-7dc98c7588-5m6xj.default                    SYNCED     SYNCED     SYNCED     SYNCED       istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br><span class="line">reviews-v1-7f99cc4496-rtsqn.default                    SYNCED     SYNCED     SYNCED     SYNCED       istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br><span class="line">reviews-v2-7d79d5bd5d-tj6kf.default                    SYNCED     SYNCED     SYNCED     SYNCED       istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br><span class="line">reviews-v3-7dbcdcbc56-t8wrx.default                    SYNCED     SYNCED     SYNCED     SYNCED       istiod-6cf8d4f9cb-wm7x6     1.7.0</span><br></pre></td></tr></table></figure><p>在 <code>proxy-status</code> 后面加上 <name>  可以查看 <code>Diff</code> 信息</name></p><h2 id="Envoy-配置查询"><a href="#Envoy-配置查询" class="headerlink" title="Envoy 配置查询"></a>Envoy 配置查询</h2><h3 id="Cluster-检查"><a href="#Cluster-检查" class="headerlink" title="Cluster 检查"></a>Cluster 检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ istioctl proxy-config cluster -n istio-system istio-ingressgateway-7d6874b48f-qxhn5</span><br><span class="line">SERVICE FQDN                                                               PORT      SUBSET     DIRECTION     TYPE           DESTINATION RULE</span><br><span class="line">BlackHoleCluster                                                           -         -          -             STATIC</span><br><span class="line">agent                                                                      -         -          -             STATIC</span><br><span class="line">details.default.svc.cluster.local                                          9080      -          outbound      EDS            details.default</span><br><span class="line">istio-ingressgateway.istio-system.svc.cluster.local                        80        -          outbound      EDS</span><br><span class="line">istio-ingressgateway.istio-system.svc.cluster.local                        443       -          outbound      EDS</span><br><span class="line">istio-ingressgateway.istio-system.svc.cluster.local                        15021     -          outbound      EDS</span><br><span class="line">istio-ingressgateway.istio-system.svc.cluster.local                        15443     -          outbound      EDS</span><br><span class="line">istiod.istio-system.svc.cluster.local                                      443       -          outbound      EDS</span><br><span class="line">istiod.istio-system.svc.cluster.local                                      853       -          outbound      EDS</span><br><span class="line">istiod.istio-system.svc.cluster.local                                      15010     -          outbound      EDS</span><br><span class="line">istiod.istio-system.svc.cluster.local                                      15012     -          outbound      EDS</span><br><span class="line">istiod.istio-system.svc.cluster.local                                      15014     -          outbound      EDS</span><br><span class="line">kube-dns.kube-system.svc.cluster.local                                     53        -          outbound      EDS</span><br><span class="line">kube-dns.kube-system.svc.cluster.local                                     9153      -          outbound      EDS</span><br><span class="line">kubernetes.default.svc.cluster.local                                       443       -          outbound      EDS</span><br><span class="line">...</span><br><span class="line">productpage.default.svc.cluster.local                                      9080      -          outbound      EDS</span><br><span class="line">prometheus_stats                                                           -         -          -             STATIC</span><br><span class="line">ratings.default.svc.cluster.local                                          9080      -          outbound      EDS</span><br><span class="line">reviews.default.svc.cluster.local                                          9080      -          outbound      EDS</span><br><span class="line">sds-grpc                                                                   -         -          -             STATIC</span><br><span class="line">xds-grpc                                                                   -         -          -             STRICT_DNS</span><br><span class="line">zipkin                                                                     -         -          -             STRICT_DNS</span><br></pre></td></tr></table></figure><h3 id="listener-检查"><a href="#listener-检查" class="headerlink" title="listener 检查"></a>listener 检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ istioctl proxy-config listeners productpage-v1-6c886ff494-7vxhs -o json --address 0.0.0.0 --port 9080</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"><span class="string">"rds"</span>: &#123;</span><br><span class="line">    <span class="string">"configSource"</span>: &#123;</span><br><span class="line">        <span class="string">"ads"</span>: &#123;&#125;,</span><br><span class="line">        <span class="string">"resourceApiVersion"</span>: <span class="string">"V3"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"routeConfigName"</span>: <span class="string">"9080"</span></span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="route-检查"><a href="#route-检查" class="headerlink" title="route 检查"></a>route 检查</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ istioctl proxy-config routes productpage-v1-6c886ff494-7vxhs --name 9080 -o json</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"9080"</span>,</span><br><span class="line">        <span class="string">"virtualHosts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"name"</span>: <span class="string">"reviews.default.svc.cluster.local:9080"</span>,</span><br><span class="line">                <span class="string">"domains"</span>: [</span><br><span class="line">                    <span class="string">"reviews.default.svc.cluster.local"</span>,</span><br><span class="line">                    <span class="string">"reviews.default.svc.cluster.local:9080"</span>,</span><br><span class="line">                    <span class="string">"reviews"</span>,</span><br><span class="line">                    <span class="string">"reviews:9080"</span>,</span><br><span class="line">                    <span class="string">"reviews.default.svc.cluster"</span>,</span><br><span class="line">                    <span class="string">"reviews.default.svc.cluster:9080"</span>,</span><br><span class="line">                    <span class="string">"reviews.default.svc"</span>,</span><br><span class="line">                    <span class="string">"reviews.default.svc:9080"</span>,</span><br><span class="line">                    <span class="string">"reviews.default"</span>,</span><br><span class="line">                    <span class="string">"reviews.default:9080"</span>,</span><br><span class="line">                    <span class="string">"10.98.88.0"</span>,</span><br><span class="line">                    <span class="string">"10.98.88.0:9080"</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="string">"routes"</span>: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="string">"name"</span>: <span class="string">"default"</span>,</span><br><span class="line">                        <span class="string">"match"</span>: &#123;</span><br><span class="line">                            <span class="string">"prefix"</span>: <span class="string">"/"</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="string">"route"</span>: &#123;</span><br><span class="line">                            <span class="string">"cluster"</span>: <span class="string">"outbound|9080||reviews.default.svc.cluster.local"</span>,</span><br><span class="line">                            <span class="string">"timeout"</span>: <span class="string">"0s"</span>,</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h3 id="Envoy管理接口"><a href="#Envoy管理接口" class="headerlink" title="Envoy管理接口"></a>Envoy管理接口</h3><p>Envoy提供了管理接口，缺省为localhost 的 15000 端口，可以获取 listener，cluster以及完整的配置数据导出功能。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">kubectl <span class="built_in">exec</span> productpage-v1-6d8bc58dd7-ts8kw -c istio-proxy curl http://127.0.0.1:15000/<span class="built_in">help</span></span><br><span class="line">  /: Admin home page</span><br><span class="line">  /certs: <span class="built_in">print</span> certs on machine</span><br><span class="line">  /clusters: upstream cluster status</span><br><span class="line">  /config_dump: dump current Envoy configs (experimental)</span><br><span class="line">  /cpuprofiler: <span class="built_in">enable</span>/<span class="built_in">disable</span> the CPU profiler</span><br><span class="line">  /healthcheck/fail: cause the server to fail health checks</span><br><span class="line">  /healthcheck/ok: cause the server to pass health checks</span><br><span class="line">  /<span class="built_in">help</span>: <span class="built_in">print</span> out list of admin commands</span><br><span class="line">  /hot_restart_version: <span class="built_in">print</span> the hot restart compatibility version</span><br><span class="line">  /listeners: <span class="built_in">print</span> listener addresses</span><br><span class="line">  /logging: query/change logging levels</span><br><span class="line">  /quitquitquit: <span class="built_in">exit</span> the server</span><br><span class="line">  /reset_counters: reset all counters to zero</span><br><span class="line">  /runtime: <span class="built_in">print</span> runtime values</span><br><span class="line">  /runtime_modify: modify runtime values</span><br><span class="line">  /server_info: <span class="built_in">print</span> server version/status information</span><br><span class="line">  /stats: <span class="built_in">print</span> server stats</span><br><span class="line">  /stats/prometheus: <span class="built_in">print</span> server stats <span class="keyword">in</span> prometheus format</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;https://s3.jpg.cm/2020/10/29/Nhq9u.png&quot; alt=&quot;Nhq9u.png&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="isito" scheme="http://wiki.yanick.site/categories/isito/"/>
    
    
      <category term="isito" scheme="http://wiki.yanick.site/tags/isito/"/>
    
  </entry>
  
  <entry>
    <title>Debug Linux</title>
    <link href="http://wiki.yanick.site/wiki/os/debug-linux/"/>
    <id>http://wiki.yanick.site/wiki/os/debug-linux/</id>
    <published>2020-09-24T16:24:41.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Virtualbox"><a href="#Virtualbox" class="headerlink" title="Virtualbox"></a>Virtualbox</h1><h2 id="装载-Additions"><a href="#装载-Additions" class="headerlink" title="装载 Additions"></a>装载 Additions</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mount /dev/cdrom /media/ -o loop</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /media</span><br><span class="line"></span><br><span class="line">sudo ./VBoxLinuxAdditions.run</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="载入"><a href="#载入" class="headerlink" title="载入"></a>载入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo modprobe -a vboxguest vboxsf vboxvideo</span><br><span class="line">sudo mount -t vboxsf &lt;NAME&gt; /mnt/shared/</span><br></pre></td></tr></table></figure><h1 id="Build-debug-kenrel"><a href="#Build-debug-kenrel" class="headerlink" title="Build debug kenrel"></a>Build debug kenrel</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /boot/</span><br><span class="line">make oldconfig</span><br></pre></td></tr></table></figure><h1 id="build"><a href="#build" class="headerlink" title="build"></a>build</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Virtualbox&quot;&gt;&lt;a href=&quot;#Virtualbox&quot; class=&quot;headerlink&quot; title=&quot;Virtualbox&quot;&gt;&lt;/a&gt;Virtualbox&lt;/h1&gt;&lt;h2 id=&quot;装载-Additions&quot;&gt;&lt;a href=&quot;#装载-Additi
      
    
    </summary>
    
      <category term="virtual machine" scheme="http://wiki.yanick.site/categories/virtual-machine/"/>
    
    
  </entry>
  
  <entry>
    <title>为 QEMU 配置网桥上网</title>
    <link href="http://wiki.yanick.site/wiki/os/qemu/"/>
    <id>http://wiki.yanick.site/wiki/os/qemu/</id>
    <published>2020-09-24T11:49:34.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h2 id="工具安装"><a href="#工具安装" class="headerlink" title="工具安装"></a>工具安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bridge-utils        <span class="comment"># 虚拟网桥工具</span></span><br><span class="line">apt-get install uml-utilities       <span class="comment"># UML（User-mode linux）工具</span></span><br></pre></td></tr></table></figure><h2 id="配置网桥"><a href="#配置网桥" class="headerlink" title="配置网桥"></a>配置网桥</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ifconfig &lt;你的网卡名称(能上网的那张)&gt; down    <span class="comment"># 首先关闭宿主机网卡接口</span></span><br><span class="line">brctl addbr br0                     <span class="comment"># 添加一座名为 br0 的网桥</span></span><br><span class="line">brctl addif br0 &lt;你的网卡名称&gt;        <span class="comment"># 在 br0 中添加一个接口</span></span><br><span class="line">brctl stp br0 off                   <span class="comment"># 如果只有一个网桥，则关闭生成树协议</span></span><br><span class="line">brctl setfd br0 1                   <span class="comment"># 设置 br0 的转发延迟</span></span><br><span class="line">brctl sethello br0 1                <span class="comment"># 设置 br0 的 hello 时间</span></span><br><span class="line">ifconfig br0 0.0.0.0 promisc up     <span class="comment"># 启用 br0 接口</span></span><br><span class="line">ifconfig &lt;你的网卡名称&gt; 0.0.0.0 promisc up    <span class="comment"># 启用网卡接口</span></span><br><span class="line">dhclient br0                        <span class="comment"># 从 dhcp 服务器获得 br0 的 IP 地址</span></span><br><span class="line">brctl show br0                      <span class="comment"># 查看虚拟网桥列表</span></span><br><span class="line">brctl showstp br0                   <span class="comment"># 查看 br0 的各接口信息</span></span><br></pre></td></tr></table></figure><h2 id="创建-TAP"><a href="#创建-TAP" class="headerlink" title="创建 TAP"></a>创建 TAP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tunctl -t tap0 -u &lt;YOUR_ACCOUNT&gt;              <span class="comment"># 创建一个 tap0 接口，只允许 XXX 用户访问</span></span><br><span class="line">brctl addif br0 tap0                <span class="comment"># 在虚拟网桥中增加一个 tap0 接口</span></span><br><span class="line">ifconfig tap0 0.0.0.0 promisc up    <span class="comment"># 启用 tap0 接口</span></span><br><span class="line">brctl showstp br0                   <span class="comment"># 显示 br0 的各个接口</span></span><br></pre></td></tr></table></figure><h2 id="启动参数"><a href="#启动参数" class="headerlink" title="启动参数"></a>启动参数</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo qemu-system-mipsel -M malta -kernel vmlinux-3.2.0-4-4kc-malta -hda debian_squeeze_mipsel_standard.qcow2 -append <span class="string">"root=/dev/sda1 console=tty0"</span> -nographic </span><br><span class="line"></span><br><span class="line">-net nic -net tap,ifname=tap0,script=no,downscript=no</span><br></pre></td></tr></table></figure><p>-net nic 表示希望 QEMU 在虚拟机中创建一张虚拟网卡，-net tap 表示连接类型为 TAP，并且指定了网卡接口名称(就是刚才创建的 tap0，相当于把虚拟机接入网桥)。</p><p>script 和 downscript 两个选项的作用是告诉 QEMU 在启动系统的时候是否调用脚本自动配置网络环境，如果这两个选项为空，那么 QEMU 启动和退出时会自动选择第一个不存在的 tap 接口(通常是 tap0)为参数，调用脚本 /etc/qemu-ifup 和 /etc/qemu-ifdown。由于我们已经配置完毕，所以这两个参数设置为 no 即可。</p><h2 id="Host-转发设置"><a href="#Host-转发设置" class="headerlink" title="Host 转发设置"></a>Host 转发设置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure><h2 id="VM-内设置"><a href="#VM-内设置" class="headerlink" title="VM 内设置"></a>VM 内设置</h2><p>假设本机IP为 192.168.142.186，br0 的IP为  172.16.66.128</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 up</span><br><span class="line">ifconfig eth0 192.168.142.187 netmask 255.255.240.0 <span class="comment"># 为网卡设置IP</span></span><br><span class="line">route add default gw 192.168.142.186 <span class="comment"># 增加路由表</span></span><br></pre></td></tr></table></figure><p>测试一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/ <span class="comment"># ping -c 4 114.114.114.114</span></span><br><span class="line">PING 114.114.114.114 (114.114.114.114): 56 data bytes</span><br><span class="line">64 bytes from 114.114.114.114: seq=0 ttl=128 time=31.034 ms</span><br><span class="line">64 bytes from 114.114.114.114: seq=1 ttl=128 time=24.453 ms</span><br><span class="line">64 bytes from 114.114.114.114: seq=2 ttl=128 time=20.257 ms</span><br><span class="line">64 bytes from 114.114.114.114: seq=3 ttl=128 time=24.996 ms</span><br><span class="line"></span><br><span class="line">--- 114.114.114.114 ping statistics ---</span><br><span class="line">4 packets transmitted, 4 packets received, 0% packet loss</span><br><span class="line">round-trip min/avg/max = 20.257/25.185/31.034 ms</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://wzt.ac.cn/2019/09/10/QEMU-networking/" rel="external nofollow noopener noreferrer" target="_blank">QEMU 网络配置一把梭</a></li><li><a href="https://blog.csdn.net/leafrenchleaf/article/details/84807316" rel="external nofollow noopener noreferrer" target="_blank">tap的方式使用qemu建立虚拟机桥接网络</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;工具安装&quot;&gt;&lt;a href=&quot;#工具安装&quot; class=&quot;headerlink&quot; title=&quot;工具安装&quot;&gt;&lt;/a&gt;工具安装&lt;/h2&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre
      
    
    </summary>
    
      <category term="os" scheme="http://wiki.yanick.site/categories/os/"/>
    
      <category term="qemu" scheme="http://wiki.yanick.site/categories/os/qemu/"/>
    
    
  </entry>
  
  <entry>
    <title>常见中间件性能瓶颈</title>
    <link href="http://wiki.yanick.site/wiki/arch/bottleneck/"/>
    <id>http://wiki.yanick.site/wiki/arch/bottleneck/</id>
    <published>2020-06-27T09:32:50.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="architecture" scheme="http://wiki.yanick.site/categories/architecture/"/>
    
    
  </entry>
  
  <entry>
    <title>inoreader 无法显示图片</title>
    <link href="http://wiki.yanick.site/wiki/tips/inoreader-can-not-show-pic/"/>
    <id>http://wiki.yanick.site/wiki/tips/inoreader-can-not-show-pic/</id>
    <published>2020-06-23T16:27:50.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><p>安装 <code>referer control</code> 禁止 inoreader 向第三方站点发送 referrer</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://www.v2ex.com/amp/t/562142" rel="external nofollow noopener noreferrer" target="_blank">inoreader 图片不显示是什么情况</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;解决办法&quot;&gt;&lt;a href=&quot;#解决办法&quot; class=&quot;headerlink&quot; title=&quot;解决办法&quot;&gt;&lt;/a&gt;解决办法&lt;/h1&gt;&lt;p&gt;安装 &lt;code&gt;referer control&lt;/code&gt; 禁止 inoreader 向第三方站点发送 referrer
      
    
    </summary>
    
      <category term="tips" scheme="http://wiki.yanick.site/categories/tips/"/>
    
    
  </entry>
  
  <entry>
    <title>Linux Device Driver 笔记</title>
    <link href="http://wiki.yanick.site/wiki/linux/ldd/"/>
    <id>http://wiki.yanick.site/wiki/linux/ldd/</id>
    <published>2020-06-20T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h1><p>先下载 Linux 源码，然后准备到开发驱动的必须前置工作</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make oldconfig</span><br><span class="line">make prepare</span><br><span class="line">make modules_prepare</span><br></pre></td></tr></table></figure><h1 id="编译-Helloworld"><a href="#编译-Helloworld" class="headerlink" title="编译 Helloworld"></a>编译 Helloworld</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/vigith/Linux-Device-Drivers.git</span><br><span class="line"></span><br><span class="line">make -C /root/linux-2.6.32.4/ M=`<span class="built_in">pwd</span>` modules</span><br></pre></td></tr></table></figure><p>-C: 指定 Linux 源码位置</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Prepare&quot;&gt;&lt;a href=&quot;#Prepare&quot; class=&quot;headerlink&quot; title=&quot;Prepare&quot;&gt;&lt;/a&gt;Prepare&lt;/h1&gt;&lt;p&gt;先下载 Linux 源码，然后准备到开发驱动的必须前置工作&lt;/p&gt;
&lt;figure class=&quot;h
      
    
    </summary>
    
      <category term="linux" scheme="http://wiki.yanick.site/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>TCPDUMP</title>
    <link href="http://wiki.yanick.site/wiki/linux/tcpdump/"/>
    <id>http://wiki.yanick.site/wiki/linux/tcpdump/</id>
    <published>2020-06-20T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<ol><li>抓取 HTTP 协议内容</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -A -s 0 <span class="string">'tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)'</span></span><br></pre></td></tr></table></figure><ol start="2"><li>抓取特定来源的HTTP</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -A -s 0 <span class="string">'src example.com and tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)'</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ol&gt;
&lt;li&gt;抓取 HTTP 协议内容&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td
      
    
    </summary>
    
      <category term="linux" scheme="http://wiki.yanick.site/categories/linux/"/>
    
    
  </entry>
  
  <entry>
    <title>常见虚拟机挂载共享目录问题</title>
    <link href="http://wiki.yanick.site/wiki/virtualmachine/mount-file/"/>
    <id>http://wiki.yanick.site/wiki/virtualmachine/mount-file/</id>
    <published>2020-06-06T16:27:50.000Z</published>
    <updated>2021-03-22T04:00:31.850Z</updated>
    
    <content type="html"><![CDATA[<h1 id="VMware-Functions"><a href="#VMware-Functions" class="headerlink" title="VMware Functions"></a>VMware Functions</h1><p>试试这个</p><p><img src="https://s1.ax1x.com/2020/06/15/NPe0PS.png" alt="NPe0PS.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/vmhgfs-fuse .host:/ /mnt/hgfs -o subtype=vmhgfs-fuse,allow_other</span><br></pre></td></tr></table></figure><h1 id="Virtualbox"><a href="#Virtualbox" class="headerlink" title="Virtualbox"></a>Virtualbox</h1><h2 id="装载-Additions"><a href="#装载-Additions" class="headerlink" title="装载 Additions"></a>装载 Additions</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mount /dev/cdrom /media/ -o loop</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /media</span><br><span class="line"></span><br><span class="line">sudo ./VBoxLinuxAdditions.run</span><br><span class="line"></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="载入"><a href="#载入" class="headerlink" title="载入"></a>载入</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo modprobe -a vboxguest vboxsf vboxvideo</span><br><span class="line">sudo mount -t vboxsf &lt;NAME&gt; /mnt/shared/</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;VMware-Functions&quot;&gt;&lt;a href=&quot;#VMware-Functions&quot; class=&quot;headerlink&quot; title=&quot;VMware Functions&quot;&gt;&lt;/a&gt;VMware Functions&lt;/h1&gt;&lt;p&gt;试试这个&lt;/p&gt;
&lt;p&gt;&lt;i
      
    
    </summary>
    
      <category term="virtual machine" scheme="http://wiki.yanick.site/categories/virtual-machine/"/>
    
    
  </entry>
  
  <entry>
    <title>Clion中管理Makefile项目</title>
    <link href="http://wiki.yanick.site/wiki/tools/ide/work-with-makefile-in-clion/"/>
    <id>http://wiki.yanick.site/wiki/tools/ide/work-with-makefile-in-clion/</id>
    <published>2020-06-06T16:27:50.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Tut"><a href="#Tut" class="headerlink" title="Tut"></a>Tut</h1><h2 id="安装-PIP"><a href="#安装-PIP" class="headerlink" title="安装 PIP"></a>安装 PIP</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python-pip</span><br></pre></td></tr></table></figure><h2 id="install-compiledb"><a href="#install-compiledb" class="headerlink" title="install compiledb"></a>install compiledb</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install compiledb</span><br></pre></td></tr></table></figure><h2 id="compile-db"><a href="#compile-db" class="headerlink" title="compile db"></a>compile db</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compiledb -n make</span><br></pre></td></tr></table></figure><h2 id="install-plugin-for-clion"><a href="#install-plugin-for-clion" class="headerlink" title="install plugin for clion"></a>install plugin for clion</h2><p>skip</p><h2 id="open-project"><a href="#open-project" class="headerlink" title="open project"></a>open project</h2><p>CLion will detect the compile_commands.json file and look in there for its project information. You may see it think about it for a few seconds, then show the “Compiler Info” tab on the Build tool window, telling you that everything finished ok (there were any errors or warnings you’ll see them in the “Sync” tab).</p><h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ul><li><a href="https://blog.jetbrains.com/clion/2018/08/working-with-makefiles-in-clion-using-compilation-db/" rel="external nofollow noopener noreferrer" target="_blank">Working with Makefiles in CLion using Compilation DB</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Tut&quot;&gt;&lt;a href=&quot;#Tut&quot; class=&quot;headerlink&quot; title=&quot;Tut&quot;&gt;&lt;/a&gt;Tut&lt;/h1&gt;&lt;h2 id=&quot;安装-PIP&quot;&gt;&lt;a href=&quot;#安装-PIP&quot; class=&quot;headerlink&quot; title=&quot;安装 PIP&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="tools" scheme="http://wiki.yanick.site/categories/tools/"/>
    
      <category term="ide" scheme="http://wiki.yanick.site/categories/tools/ide/"/>
    
      <category term="clion" scheme="http://wiki.yanick.site/categories/tools/ide/clion/"/>
    
    
  </entry>
  
  <entry>
    <title>构建与调试 Linux 内核</title>
    <link href="http://wiki.yanick.site/wiki/linux/build-and-debug-kernel/"/>
    <id>http://wiki.yanick.site/wiki/linux/build-and-debug-kernel/</id>
    <published>2020-05-15T16:09:25.000Z</published>
    <updated>2021-03-22T04:00:31.846Z</updated>
    
    <content type="html"><![CDATA[<p>本文以读者的 Linux 4.19 为构建目标</p><h2 id="构建Linux内核"><a href="#构建Linux内核" class="headerlink" title="构建Linux内核"></a>构建Linux内核</h2><h3 id="安装-GCC"><a href="#安装-GCC" class="headerlink" title="安装 GCC"></a>安装 GCC</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install gcc</span><br></pre></td></tr></table></figure><h3 id="构建配置"><a href="#构建配置" class="headerlink" title="构建配置"></a>构建配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br><span class="line"><span class="comment"># 选择 kernel hacking —&gt; [*] compile the kernel with debug info 让其携带调试信息</span></span><br><span class="line">make defconfig 生成配置文件</span><br><span class="line">make 编译kernel</span><br></pre></td></tr></table></figure><h2 id="准备运行环境"><a href="#准备运行环境" class="headerlink" title="准备运行环境"></a>准备运行环境</h2><p>因为我们只有一个 <code>Kerenl</code>，我们还需要可以运行的 <code>rootfs</code> 等，最简单的方式是基于已经成熟的 Linux 发行版进行替换内核的方式进行运行。</p><h3 id="准备-Ubuntu-镜像"><a href="#准备-Ubuntu-镜像" class="headerlink" title="准备 Ubuntu 镜像"></a>准备 Ubuntu 镜像</h3><p>在 <code>Virtualbox</code> 中安装 <code>ubuntu server 14.04</code></p><h3 id="增加-kgdb-启动参数"><a href="#增加-kgdb-启动参数" class="headerlink" title="增加 kgdb 启动参数"></a>增加 <code>kgdb</code> 启动参数</h3><p>在 /etc/default/grub 中增加 <code>kgdb</code> 的启动参数</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kgdbwait kgdboc=ttyS0,115200 sysrq_always_enabled nokaslr</span><br></pre></td></tr></table></figure><h3 id="给宿主机增加串口虚拟文件"><a href="#给宿主机增加串口虚拟文件" class="headerlink" title="给宿主机增加串口虚拟文件"></a>给宿主机增加串口虚拟文件</h3><p>在virtualbox的settings里面选择serial port，勾选enable serial port，之后取消勾选connect to existing pipe/socket。port number、irq、I/O port就使用默认，port mode选择HOST PIPE，下面的目录填上/tmp/serial。</p><h3 id="替换我们的内核镜像"><a href="#替换我们的内核镜像" class="headerlink" title="替换我们的内核镜像"></a>替换我们的内核镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure><hr><p>最后一步就是直接重启我们的系统，这个时候你会发现系统停留在启动页面了。</p><h2 id="连接系统进行调试"><a href="#连接系统进行调试" class="headerlink" title="连接系统进行调试"></a>连接系统进行调试</h2><h3 id="attach"><a href="#attach" class="headerlink" title="attach"></a>attach</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -d -d /tmp/serial PTY</span><br></pre></td></tr></table></figure><h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb vmlinux</span><br><span class="line">target remote /dev/pts/1</span><br></pre></td></tr></table></figure><h3 id="回复debug模式"><a href="#回复debug模式" class="headerlink" title="回复debug模式"></a>回复debug模式</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> g &gt; /dev/sysrq-trigger</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://blog.0x972.info/?d=2014/11/27/18/45/48-linux-kernel-system-debugging-part-1-system-setup" rel="external nofollow noopener noreferrer" target="_blank">Linux Kernel System Debugging, part 1: System Setup</a></li><li><a href="http://nickdesaulniers.github.io/blog/2018/10/24/booting-a-custom-linux-kernel-in-qemu-and-debugging-it-with-gdb/" rel="external nofollow noopener noreferrer" target="_blank">Booting a Custom Linux Kernel in QEMU and Debugging It With GDB</a></li><li><a href="https://blog.csdn.net/gouxf_0219/article/details/82018970" rel="external nofollow noopener noreferrer" target="_blank">gcc: error: elf_x86_64: No such file or directory</a></li><li><a href="https://www.kernel.org/doc/html/v4.14/dev-tools/kgdb.html" rel="external nofollow noopener noreferrer" target="_blank">kgdb</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文以读者的 Linux 4.19 为构建目标&lt;/p&gt;
&lt;h2 id=&quot;构建Linux内核&quot;&gt;&lt;a href=&quot;#构建Linux内核&quot; class=&quot;headerlink&quot; title=&quot;构建Linux内核&quot;&gt;&lt;/a&gt;构建Linux内核&lt;/h2&gt;&lt;h3 id=&quot;安装-GCC
      
    
    </summary>
    
      <category term="linux" scheme="http://wiki.yanick.site/categories/linux/"/>
    
    
  </entry>
  
</feed>
